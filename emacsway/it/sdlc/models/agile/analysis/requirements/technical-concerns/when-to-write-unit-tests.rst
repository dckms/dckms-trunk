:canonical-base-url: https://dckms.github.io/system-architecture

.. index::
   single: Unit Test; when to write
   :name: emacsway-when-to-write-unit-tests

================================
–ö–æ–≥–¥–∞ –ø–∏—Å–∞—Ç—å Unit Tests –≤ legacy
================================

.. sectionauthor:: Ivan Zakrevsky

–û —Ç–æ–º, –∫–æ–≥–¥–∞ –ø–∏—Å–∞—Ç—å —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –≤ —É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω–æ–º –∫–æ–¥–µ, –æ—Ç –∞–≤—Ç–æ—Ä–∞ xUnit (sUnit):

    üìù "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

    –ö–æ–≥–¥–∞ –≤—ã –ø—Ä–∏—Å—Ç—É–ø–∏—Ç–µ –∫ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—é —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏ –•–†, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–Ω–µ—Ç –¥–ª—è –≤–∞—Å, –Ω–∞–≤–µ—Ä–Ω–æ–µ, –Ω–∞–∏–±–æ–ª–µ–µ —Ä–∞–∑–æ—á–∞—Ä–æ–≤—ã–≤–∞—é—â–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º.
    –ö–æ–¥, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–π –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã –ø–∏—à–µ—Ç–µ —Ç–µ—Å—Ç—ã, –∫–∞–∂–µ—Ç—Å—è –ø—É–≥–∞—é—â–∏–º.
    –í—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–Ω–∞–µ—Ç–µ, –≥–¥–µ –∏–º–µ–Ω–Ω–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –∏ –≤ –∫–∞–∫–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –±–µ–∑ –æ–ø–∞—Å–µ–Ω–∏–π –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —à–∞–≥.
    "–ß—Ç–æ, –µ—Å–ª–∏ —è –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é —ç—Ç—É —Å—Ç—Ä–æ–∫—É? –ë—É–¥–µ—Ç –ª–∏ —ç—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º?" –í—ã –Ω–µ —É–≤–µ—Ä–µ–Ω—ã –≤ —ç—Ç–æ–º.

    –ö–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã –Ω–∞—á–∏–Ω–∞–µ—Ç–µ –ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã, –∫–∞—Ä—Ç–∏–Ω–∞ –º–µ–Ω—è–µ—Ç—Å—è.
    –í—ã —É–≤–µ—Ä–µ–Ω—ã –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ.
    –í—ã –Ω–µ –∑–∞–¥—É–º—ã–≤–∞–µ—Ç–µ—Å—å –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –≤–Ω–µ—Å—Ç–∏ –≤ –Ω–µ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
    –î–ª—è –≤–∞—Å —ç—Ç–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏—è—Ç–Ω—ã–º.

    –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞ –∫ –Ω–æ–≤–æ–º—É –∫–æ–¥—É ‚Äî —ç—Ç–æ –∫–∞–∫ –≤—ã—Ö–æ–¥ –∏–∑ —Ç–µ–º–Ω–æ—Ç—ã –Ω–∞ —Å–æ–ª–Ω–µ—á–Ω—ã–π —Å–≤–µ—Ç.
    –í—ã –Ω–∞—á–Ω–µ—Ç–µ –ª–æ–≤–∏—Ç—å —Å–µ–±—è –Ω–∞ —Ç–æ–º, —á—Ç–æ –≤—ã –∏–∑–±–µ–≥–∞–µ—Ç–µ —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º.
    –í—ã –¥–æ–ª–∂–Ω—ã —Å–æ–ø—Ä–æ—Ç–∏–≤–ª—è—Ç—å—Å—è —ç—Ç–æ–π —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏.
    –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–ø–æ—Å–æ–±–æ–º –æ–±—Ä–µ—Å—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–∏—Ç—É–∞—Ü–∏–µ–π –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —è–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –Ω–æ–≤—ã–º–∏ –±–æ–ª–µ–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏.
    –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –≤ —Ç–µ–º–Ω–æ—Ç–µ –Ω–∞—á–Ω—É—Ç —Å–∫–∞–ø–ª–∏–≤–∞—Ç—å—Å—è —Å—Ç—Ä–∞—à–Ω—ã–µ —á—É–¥–æ–≤–∏—â–∞, –∫–æ—Ç–æ—Ä—ã–µ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –º–æ–≥—É—Ç –≤—ã–ø—Ä—ã–≥–Ω—É—Ç—å –Ω–∞—Ä—É–∂—É.
    –û—Å—Ç–∞–≤–ª—è—è —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –≤ –ø—Ä–µ–∂–Ω–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ —Ä–∏—Å–∫, –≤–µ–ª–∏—á–∏–Ω—É –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–ª–æ–∂–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å.

    **–í –ø–æ–¥–æ–±–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —Å–æ–±–ª–∞–∑–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞–∑–∞–¥ –∏ –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ–≥–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞.**
    **–ù–µ –¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ–≥–æ.**
    **–¢–µ—Å—Ç—ã –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞ —Å–ª–µ–¥—É–µ—Ç –ø–∏—Å–∞—Ç—å –ø–æ –º–µ—Ä–µ –Ω–∞–¥–æ–±–Ω–æ—Å—Ç–∏.**

    - –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≤ –Ω–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥, –≤–Ω–∞—á–∞–ª–µ –Ω–∞–ø–∏—à–∏—Ç–µ —Ç–µ—Å—Ç—ã –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.
    - –ï—Å–ª–∏ –≤—ã –Ω–∞–º–µ—Ä–µ–Ω—ã –∏—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É –≤ —Å—Ç–∞—Ä–æ–º –∫–æ–¥–µ, —Å–Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—à–∏—Ç–µ —Ç–µ—Å—Ç.
    - –ï—Å–ª–∏ –≤—ã –Ω–∞–º–µ—Ä–µ–Ω—ã –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å —É—á–∞—Å—Ç–æ–∫ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥–∞, —Å–Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—à–∏—Ç–µ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–µ—Å—Ç—ã.

    –í—ã –æ–±–Ω–∞—Ä—É–∂–∏—Ç–µ, —á—Ç–æ –≤–Ω–∞—á–∞–ª–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–º–µ–¥–ª–∏—Ç—Å—è.
    –í—ã –±—É–¥–µ—Ç–µ —Ç—Ä–∞—Ç–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –Ω–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤, —á–µ–º —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è —ç—Ç–æ–≥–æ –≤ —Ä–∞–º–∫–∞—Ö –æ–±—ã—á–Ω–æ–π –•–†, –∏ —É –≤–∞—Å –ø–æ—è–≤–∏—Ç—Å—è –æ—â—É—â–µ–Ω–∏–µ, —á—Ç–æ –≤—ã —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç–µ –Ω–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–æ–ª–µ–µ –º–µ–¥–ª–µ–Ω–Ω–æ, —á–µ–º —Ä–∞–Ω—å—à–µ.

    –û–¥–Ω–∞–∫–æ —Ä–∞–∑–¥–µ–ª—ã —Å–∏—Å—Ç–µ–º—ã, –∫ –∫–æ—Ç–æ—Ä—ã–º –≤—ã –æ–±—Ä–∞—â–∞–µ—Ç–µ—Å—å —á–∞—â–µ –≤—Å–µ–≥–æ, —á–∞—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–ª–µ–∫–∞—é—Ç –∫ —Å–µ–±–µ –Ω–∞–∏–±–æ–ª—å—à–µ–µ –≤–Ω–∏–º–∞–Ω–∏–µ, –∞ —Ç–∞–∫–∂–µ –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –≤ –æ–±–æ–∑—Ä–∏–º–æ–º –±—É–¥—É—â–µ–º –±—É–¥—É—Ç —Ç—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã.
    –í —Å–∫–æ—Ä–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ—Å—è —á–∞—â–µ –¥—Ä—É–≥–∏—Ö, –±—É–¥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å, –∫–∞–∫ –±—É–¥—Ç–æ –æ–Ω–∏ —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—Å–∞–Ω—ã —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –•–†.

    Testing

    Testing is perhaps the most frustrating area when you are shifting existing code to XP.
    The code written before you have tests is scary.
    You never know quite where you stand.
    Will this change be safe? You're not sure.

    As soon as you start writing the tests, the picture changes.
    You have confidence in the new code.
    You don't mind making changes.
    In fact, it's kind of fun.

    Shifting between old code and new code is like night and day.
    You will find yourself avoiding the old code.
    You have to resist this tendency.
    The only way to gain control 96in this situation is to bring all the code forward.
    Otherwise ugly things will grow in the dark.
    You will have risks of unknown magnitude.

    **In this situation, it is tempting to try to just go back and write the tests for all the existing code.**
    **Don't do this.**
    **Instead, write the tests on demand.**

    - When you need to add functionality to untested code, write tests for its current functionality first.
    - When you need to fix a bug, write a test first.
    - When you need to refactor, write tests first.

    What you will find is that development feels slow at first.
    You will spend much more time writing tests than you do in normal XP, and you will feel like you make progress on new functionality more slowly than before.
    However, the parts of the system that you visit all the time, the parts that attract attention and new features, will quickly be thoroughly tested.
    Soon, the parts of the system that are used most will feel like they were written with XP."

    -- "Extreme Programming Explained" 1st edition by Kent Beck, –ø–µ—Ä–µ–≤–æ–¥ –û–û–û –ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ "–ü–∏—Ç–µ—Ä"


.. seealso::

   - ":ref:`emacsway-when-to-refactor`"
